:toc:
:toclevels: 5
:hardbreaks-option:

== 集群

=== cluster

==== 参考
https://redis.io/topics/cluster-tutorial
https://redis.io/topics/cluster-spec

=== codis
- 简介
https://github.com/CodisLabs/codis/blob/master/doc/FAQ_zh.md
https://github.com/CodisLabs/codis/blob/master/doc/tutorial_zh.md
https://github.com/CodisLabs/codis/blob/master/doc/unsupported_cmds.md

- 特点
动态扩容/缩容，增减redis实例对client完全透明、不需要重启服务，不需要业务方担心Redis内存爆掉的问题；也不用担心申请太大, 造成浪费；业务方也不需要自己维护Redis.
扩容可以直接界面的"Auto Rebalance"按钮，缩容只需要将要下线的实例拥有的slot迁移到其它实例，然后在界面上删除下线的group即可。

- 分片
Codis采用Pre-sharding的技术来实现数据的分片, 默认分成1024个slots(0-1023), 对于每个key来说, 通过以下公式确定所属的Slot Id: SlotId = crc32(key) % 1024。
每一个slot都会有一个且必须有一个特定的server group id来表示这个slot的数据由哪个server group来提供。数据的迁移也是以slot为单位的。

- vs. redis cluster
https://github.com/CodisLabs/codis/blob/master/doc/FAQ_zh.md#%E7%9B%B8%E5%AF%B9%E4%BA%8Eredis-cluster%E7%9A%84%E4%BC%98%E5%8A%A3

- vs. twemproxy
https://github.com/CodisLabs/codis/blob/master/doc/FAQ_zh.md#%E7%9B%B8%E5%AF%B9%E4%BA%8Etwemproxy%E7%9A%84%E4%BC%98%E5%8A%A3

==== 参考
https://github.com/CodisLabs/codis/tree/master/doc
https://github.com/CodisLabs/codis
