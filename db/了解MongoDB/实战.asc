== 实战

=== Embedded Documents

- upsert 通常要分两步？
https://stackoverflow.com/questions/23470658/mongodb-upsert-sub-document
- 将array改成object: https://stackoverflow.com/questions/10277174/upsert-in-an-embedded-document 这样无法对子项建立索引
- array通常是作为一个整体的 https://docs.mongodb.com/manual/tutorial/query-array-of-documents/

    db.inventory.insertMany( [
    { item: "journal", instock: [ { warehouse: "A", qty: 5 }, { warehouse: "C", qty: 15 } ] },
    { item: "notebook", instock: [ { warehouse: "C", qty: 5 } ] },
    { item: "paper", instock: [ { warehouse: "A", qty: 60 }, { warehouse: "B", qty: 15 } ] },
    { item: "planner", instock: [ { warehouse: "A", qty: 40 }, { warehouse: "B", qty: 5 } ] },
    { item: "postcard", instock: [ { warehouse: "B", qty: 15 }, { warehouse: "C", qty: 35 } ] }
    ]);
    Q: 如何修改item: "paper", instock.warehouse: "B"的qty? 不遍历instock数组能做到吗?